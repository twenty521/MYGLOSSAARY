<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EduGlossary Smart Pro</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .chart-bar { transition: height 0.5s ease-in-out; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // --- Initial Knowledge Framework ---
        const initialFramework = {
            python: [
                { id: 101, term: 'Variable', chinese: 'å˜é‡', definition: 'å­˜å‚¨æ•°æ®å€¼çš„å®¹å™¨ï¼ŒPythonä¸­ä¸éœ€è¦å£°æ˜ç±»å‹ã€‚', example: 'x = 5\nname = "Python"' },
                { id: 102, term: 'List', chinese: 'åˆ—è¡¨', definition: 'æœ‰åºçš„å¯å˜é›†åˆï¼Œå…è®¸é‡å¤å…ƒç´ ã€‚', example: 'my_list = [1, 2, 3]' },
                { id: 103, term: 'Function', chinese: 'å‡½æ•°', definition: 'ç»„ç»‡å¥½çš„ï¼Œå¯é‡å¤ä½¿ç”¨çš„ä»£ç å—ã€‚', example: 'def greet():\n    print("Hello")' },
                { id: 104, term: 'Dictionary', chinese: 'å­—å…¸', definition: 'æ— åºçš„é”®å€¼å¯¹é›†åˆã€‚', example: 'my_dict = {"key": "value"}' },
                { id: 105, term: 'Pandas', chinese: 'æ•°æ®åˆ†æåº“', definition: 'å¼ºå¤§çš„ Python æ•°æ®å¤„ç†å’Œåˆ†æåº“ã€‚', example: 'import pandas as pd\ndf = pd.read_csv("data.csv")' }
            ],
            statistics: [
                { id: 201, term: 'Mean', chinese: 'ç®—æœ¯å¹³å‡å€¼', definition: 'æ‰€æœ‰æ•°å€¼ä¹‹å’Œé™¤ä»¥æ•°å€¼çš„ä¸ªæ•°ã€‚', example: 'Î¼ = (Î£x) / n' },
                { id: 202, term: 'Standard Deviation', chinese: 'æ ‡å‡†å·®', definition: 'åæ˜ ä¸€ç»„æ•°æ®ç¦»æ•£ç¨‹åº¦çš„æŒ‡æ ‡ã€‚', example: 'Ïƒ = sqrt(variance)' },
                { id: 203, term: 'P-value', chinese: 'På€¼', definition: 'åœ¨åŸå‡è®¾ä¸ºçœŸæ—¶ï¼Œè§‚å¯Ÿåˆ°å½“å‰æ ·æœ¬ç»“æœæˆ–æ›´æç«¯ç»“æœçš„æ¦‚ç‡ã€‚', example: 'If p < 0.05, reject H0' },
                { id: 204, term: 'Normal Distribution', chinese: 'æ­£æ€åˆ†å¸ƒ', definition: 'ä¸€ç§å‘ˆé’Ÿå½¢çš„è¿ç»­æ¦‚ç‡åˆ†å¸ƒï¼Œå‡å€¼å’Œä¸­ä½æ•°ç›¸ç­‰ã€‚', example: 'N(Î¼, ÏƒÂ²)' },
                { id: 205, term: 'Regression', chinese: 'å›å½’åˆ†æ', definition: 'ç¡®å®šä¸¤ç§æˆ–ä¸¤ç§ä»¥ä¸Šå˜é‡é—´ç›¸äº’ä¾èµ–çš„å®šé‡å…³ç³»çš„ä¸€ç§ç»Ÿè®¡åˆ†ææ–¹æ³•ã€‚', example: 'y = mx + b' }
            ],
            grammar: [
                { id: 301, term: 'Past Perfect', chinese: 'è¿‡å»å®Œæˆæ—¶', definition: 'è¡¨ç¤ºåœ¨è¿‡å»æŸä¸€æ—¶é—´æˆ–åŠ¨ä½œä»¥å‰å·²ç»å‘ç”Ÿæˆ–å®Œæˆäº†çš„åŠ¨ä½œã€‚', example: 'I had finished my homework.' },
                { id: 302, term: 'Subjunctive Mood', chinese: 'è™šæ‹Ÿè¯­æ°”', definition: 'ç”¨æ¥è¡¨ç¤ºè¯´è¯äººçš„ä¸»è§‚æ„¿æœ›ã€æ€€ç–‘ã€å»ºè®®æˆ–ä¸äº‹å®ç›¸åçš„å‡è®¾ã€‚', example: 'If I were you...' }
            ]
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('daily'); 
            const [isAdding, setIsAdding] = useState(false);
            const [searchTerm, setSearchTerm] = useState('');
            
            const [glossary, setGlossary] = useState(() => {
                const saved = localStorage.getItem('edu_glossary_smart_v5');
                return saved ? JSON.parse(saved) : initialFramework;
            });

            const [dailyLogs, setDailyLogs] = useState(() => {
                const saved = localStorage.getItem('edu_daily_logs_v5');
                return saved ? JSON.parse(saved) : {};
            });

            const [newEntry, setNewEntry] = useState({ 
                term: '', chinese: '', definition: '', example: '', image: '', tags: '' 
            });

            const [newActivity, setNewActivity] = useState({
                task: '', focus: 5, mood: 5, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
            });

            // --- å¼ºåŒ–è‡ªåŠ¨åˆ†ç±»é€»è¾‘ ---
            useEffect(() => {
                const text = newEntry.term.toLowerCase();
                const pythonKeywords = [
                    'python', 'list', 'def', 'class', 'import', 'loop', 'variable', 'print', 'array', 
                    'dictionary', 'tuple', 'string', 'int', 'float', 'pandas', 'numpy', 'matplotlib', 'sklearn'
                ];
                const statsKeywords = [
                    'mean', 'median', 'probability', 'distribution', 'test', 'sample', 'data', 'standard', 
                    'variance', 'regression', 'p-value', 'hypothesis', 'null', 'skewness', 'kurtosis'
                ];
                const grammarKeywords = [
                    'tense', 'verb', 'noun', 'clause', 'sentence', 'past', 'present', 'perfect', 
                    'passive', 'subjunctive', 'preposition', 'adjective', 'adverb'
                ];

                if (pythonKeywords.some(k => text.includes(k))) setActiveTab('python');
                else if (statsKeywords.some(k => text.includes(k))) setActiveTab('statistics');
                else if (grammarKeywords.some(k => text.includes(k))) setActiveTab('grammar');
            }, [newEntry.term]);

            useEffect(() => {
                localStorage.setItem('edu_glossary_smart_v5', JSON.stringify(glossary));
                localStorage.setItem('edu_daily_logs_v5', JSON.stringify(dailyLogs));
                if (window.lucide) window.lucide.createIcons();
            }, [glossary, dailyLogs, activeTab, isAdding]);

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onloadend = () => setNewEntry(prev => ({ ...prev, image: reader.result }));
                    reader.readAsDataURL(file);
                }
            };

            const getPsychFeedback = (focus, task) => {
                const f = parseInt(focus);
                const t = task.toLowerCase();
                if (t.includes('æ‰‹æœº') || t.includes('æ¸¸æˆ') || t.includes('åˆ·è§†é¢‘')) {
                    return { msg: "âš ï¸ è­¦æƒ•ï¼šå¤šå·´èƒºé™·é˜±ï¼æ­¤ç±»æ´»åŠ¨ä¼šæ˜¾è‘—é™ä½åç»­æ·±åº¦å­¦ä¹ çš„é˜ˆå€¼ã€‚", color: "text-rose-500" };
                }
                if (f >= 8) return { msg: "âœ¨ è¿›å…¥â€˜å¿ƒæµâ€™(Flow)çŠ¶æ€ï¼šæ­¤æ—¶å­¦ä¹ æ•ˆç‡æœ€é«˜ï¼Œè¯·å°è¯•ä¿æŒã€‚", color: "text-emerald-500" };
                if (f <= 3) return { msg: "ğŸ’¤ è®¤çŸ¥ç–²åŠ³æç¤ºï¼šå»ºè®®è¿›è¡Œ 15 åˆ†é’Ÿå†¥æƒ³æˆ–æ¢å¤æ€§ä¼‘æ¯ã€‚", color: "text-amber-500" };
                return { msg: "ğŸŒ± ç¨³å®šè¿è¡Œï¼šä¿æŒå½“å‰å­¦ä¹ èŠ‚å¥ã€‚", color: "text-indigo-500" };
            };

            const getDayAnalysis = (score) => {
                if (score >= 85) return "é»„é‡‘çŠ¶æ€ï¼šä½ çš„è®¤çŸ¥æ§åˆ¶åŠ›æå¼ºï¼Œé€‚åˆæ”»å…‹éš¾ç‚¹ã€‚";
                if (score >= 60) return "å¹³è¡¡çŠ¶æ€ï¼šè¡¨ç°ç¨³å¥ï¼Œå»ºè®®å¤ç›˜ä½åˆ†æ—¶æ®µã€‚";
                return "éœ€è°ƒæ•´çŠ¶æ€ï¼šå»ºè®®ä¼˜åŒ–ç¯å¢ƒä»¥å‡å°‘å¹²æ‰°ã€‚";
            };

            const getTodayKey = () => new Date().toISOString().split('T')[0];
            const todayLogs = dailyLogs[getTodayKey()] || { activities: [], summary: '', score: 0 };

            const saveActivity = () => {
                if (!newActivity.task) return;
                const dateKey = getTodayKey();
                const currentDay = dailyLogs[dateKey] || { activities: [], summary: '', score: 0 };
                const updatedActivities = [...currentDay.activities, { ...newActivity, id: Date.now() }];
                
                const avgFocus = updatedActivities.reduce((acc, curr) => acc + parseInt(curr.focus), 0) / updatedActivities.length;
                const avgMood = updatedActivities.reduce((acc, curr) => acc + parseInt(curr.mood), 0) / updatedActivities.length;
                const totalScore = Math.round((avgFocus * 0.7 + avgMood * 0.3) * 10);

                setDailyLogs(prev => ({
                    ...prev,
                    [dateKey]: { ...currentDay, activities: updatedActivities, score: totalScore }
                }));
                setNewActivity({ task: '', focus: 5, mood: 5, time: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'}) });
            };

            return (
                <div className="min-h-screen flex flex-col max-w-md mx-auto bg-slate-50 pb-10">
                    <header className="bg-slate-900 text-white p-6 rounded-b-[2.5rem] shadow-lg sticky top-0 z-30">
                        <div className="flex justify-between items-center mb-4">
                            <h1 className="text-xl font-black">EduGlossary <span className="text-indigo-400">Pro</span></h1>
                            <button onClick={() => setIsAdding(true)} className="bg-indigo-600 text-white p-2 rounded-xl shadow-md">
                                <i data-lucide="plus" className="w-5 h-5"></i>
                            </button>
                        </div>
                    </header>

                    <nav className="flex justify-around p-4 bg-white border-b sticky top-[76px] z-20">
                        {[
                            {id: 'python', icon: 'code'}, {id: 'statistics', icon: 'bar-chart-2'},
                            {id: 'grammar', icon: 'pen-tool'}, {id: 'daily', icon: 'activity'}
                        ].map(t => (
                            <button 
                                key={t.id} 
                                onClick={() => setActiveTab(t.id)}
                                className={`p-2 rounded-xl transition-all ${activeTab === t.id ? 'bg-indigo-50 text-indigo-600 shadow-inner' : 'text-slate-300'}`}
                            >
                                <i data-lucide={t.icon} className="w-6 h-6"></i>
                            </button>
                        ))}
                    </nav>

                    <main className="p-4 space-y-6">
                        {activeTab === 'daily' ? (
                            <div className="space-y-6">
                                <div className="bg-white p-6 rounded-[2.5rem] shadow-sm border border-slate-100">
                                    <h3 className="text-xs font-black text-slate-400 uppercase tracking-widest mb-4">çŠ¶æ€è¶‹åŠ¿å›¾</h3>
                                    <div className="h-32 flex items-end justify-around gap-2 px-2 border-b border-slate-100 mb-2">
                                        {todayLogs.activities.length > 0 ? todayLogs.activities.map((act, i) => (
                                            <div key={i} className="flex-grow flex flex-col items-center gap-1 group relative">
                                                <div className="flex w-full gap-0.5 items-end justify-center">
                                                    <div className="w-2 bg-indigo-500 rounded-t-sm chart-bar" style={{height: `${act.focus * 10}%`}}></div>
                                                    <div className="w-2 bg-pink-400 rounded-t-sm chart-bar opacity-60" style={{height: `${act.mood * 10}%`}}></div>
                                                </div>
                                            </div>
                                        )) : <div className="text-slate-200 text-xs italic mb-10">æš‚æ— æ´»åŠ¨æ•°æ®</div>}
                                    </div>
                                    <div className="flex justify-between text-[10px] text-slate-300 font-bold">
                                        <span>å¼€å§‹</span><span>ç»“æŸ</span>
                                    </div>
                                </div>

                                <div className="bg-white p-5 rounded-[2rem] border-l-4 border-indigo-500 shadow-sm">
                                    <div className="flex items-center gap-2 mb-2">
                                        <i data-lucide="brain" className="w-4 h-4 text-indigo-500"></i>
                                        <span className="text-xs font-bold text-slate-400">ä¸“ä¸šè¯„ä»·</span>
                                    </div>
                                    <div className="text-sm font-medium text-slate-700">
                                        {todayLogs.activities.length > 0 ? (
                                            getPsychFeedback(
                                                todayLogs.activities[todayLogs.activities.length-1].focus, 
                                                todayLogs.activities[todayLogs.activities.length-1].task
                                            ).msg
                                        ) : "è®°å½•æ´»åŠ¨ä»¥è·å–ç§‘å­¦åé¦ˆã€‚"}
                                    </div>
                                </div>

                                <div className="bg-indigo-600 p-6 rounded-[2.5rem] text-white shadow-xl relative overflow-hidden text-center">
                                    <div className="relative z-10">
                                        <div className="text-[10px] font-bold opacity-60 uppercase mb-1">ä»Šæ—¥è®¤çŸ¥åˆ†</div>
                                        <div className="text-6xl font-black mb-2">{todayLogs.score}</div>
                                        <div className="text-[10px] bg-white/20 px-4 py-1.5 rounded-full inline-block">
                                            {getDayAnalysis(todayLogs.score)}
                                        </div>
                                    </div>
                                </div>

                                <div className="bg-white p-5 rounded-[2.5rem] shadow-sm space-y-4">
                                    <input 
                                        className="w-full p-4 bg-slate-50 rounded-2xl outline-none text-sm"
                                        placeholder="åˆšæ‰åšäº†ä»€ä¹ˆï¼Ÿ"
                                        value={newActivity.task}
                                        onChange={e => setNewActivity({...newActivity, task: e.target.value})}
                                    />
                                    <div className="grid grid-cols-2 gap-6">
                                        <div className="space-y-2">
                                            <div className="flex justify-between text-[10px] font-black">ä¸“æ³¨åº¦ <span className="text-indigo-600">{newActivity.focus}</span></div>
                                            <input type="range" min="1" max="10" className="w-full accent-indigo-600" value={newActivity.focus} onChange={e => setNewActivity({...newActivity, focus: e.target.value})} />
                                        </div>
                                        <div className="space-y-2">
                                            <div className="flex justify-between text-[10px] font-black">å¿ƒæƒ… <span className="text-pink-500">{newActivity.mood}</span></div>
                                            <input type="range" min="1" max="10" className="w-full accent-pink-500" value={newActivity.mood} onChange={e => setNewActivity({...newActivity, mood: e.target.value})} />
                                        </div>
                                    </div>
                                    <button onClick={saveActivity} className="w-full py-4 bg-slate-900 text-white rounded-2xl font-black text-sm">è®°å½•</button>
                                </div>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                {glossary[activeTab].filter(item => item.term.toLowerCase().includes(searchTerm.toLowerCase())).map(item => (
                                    <div key={item.id} className="bg-white p-6 rounded-[2rem] shadow-sm border border-slate-100">
                                        <div className="flex justify-between items-start mb-2">
                                            <h3 className="text-lg font-black">{item.term}</h3>
                                            <button onClick={() => {
                                                setGlossary({...glossary, [activeTab]: glossary[activeTab].filter(i => i.id !== item.id)});
                                            }} className="text-slate-200"><i data-lucide="trash-2" className="w-4 h-4"></i></button>
                                        </div>
                                        <div className="text-indigo-600 font-bold text-xs mb-3">{item.chinese}</div>
                                        <p className="text-xs text-slate-500 leading-relaxed mb-4">{item.definition}</p>
                                        {item.example && (
                                            <pre className="bg-slate-50 p-3 rounded-xl text-[10px] font-mono text-slate-600 overflow-x-auto">
                                                {item.example}
                                            </pre>
                                        )}
                                        {item.image && <img src={item.image} className="rounded-2xl mt-4 w-full shadow-inner" />}
                                    </div>
                                ))}
                            </div>
                        )}
                    </main>

                    {isAdding && (
                        <div className="fixed inset-0 z-50 bg-white flex flex-col p-8 animate-in slide-in-from-bottom">
                            <div className="flex justify-between items-center mb-8">
                                <h2 className="text-2xl font-black">è®°å½•å­¦æœ¯çµæ„Ÿ</h2>
                                <button onClick={() => setIsAdding(false)} className="p-3 bg-slate-50 rounded-full text-slate-400"><i data-lucide="x"></i></button>
                            </div>
                            <form className="space-y-4 overflow-y-auto no-scrollbar" onSubmit={(e) => {
                                e.preventDefault();
                                setGlossary({...glossary, [activeTab]: [{...newEntry, id: Date.now()}, ...glossary[activeTab]]});
                                setIsAdding(false);
                                setNewEntry({ term: '', chinese: '', definition: '', example: '', image: '', tags: '' });
                            }}>
                                <div className="bg-indigo-50 p-3 rounded-xl text-[10px] text-indigo-600 font-bold flex items-center gap-2">
                                    <i data-lucide="zap" className="w-3 h-3"></i> è‡ªåŠ¨å½’ç±»ï¼šå°†å­˜å…¥ {activeTab.toUpperCase()}
                                </div>
                                <input placeholder="å­¦æœ¯æœ¯è¯­" className="w-full p-4 bg-slate-50 rounded-2xl outline-none" value={newEntry.term} onChange={e => setNewEntry({...newEntry, term: e.target.value})} />
                                <input placeholder="ä¸­æ–‡å®šä¹‰" className="w-full p-4 bg-slate-50 rounded-2xl outline-none" value={newEntry.chinese} onChange={e => setNewEntry({...newEntry, chinese: e.target.value})} />
                                <label className="w-full p-6 border-2 border-dashed border-slate-200 rounded-3xl flex flex-col items-center text-slate-400 cursor-pointer">
                                    <i data-lucide="image" className="mb-2"></i>
                                    <span className="text-xs">{newEntry.image ? "å·²é€‰æ‹©å›¾ç‰‡" : "æ·»åŠ ç›¸å†Œå›¾ç‰‡"}</span>
                                    <input type="file" className="hidden" accept="image/*" onChange={handleImageUpload} />
                                </label>
                                <textarea placeholder="è¯¦ç»†è§£é‡Š..." className="w-full p-4 bg-slate-50 rounded-2xl h-24 outline-none" value={newEntry.definition} onChange={e => setNewEntry({...newEntry, definition: e.target.value})} />
                                <textarea placeholder="ç¤ºä¾‹ä»£ç /å…¬å¼" className="w-full p-4 bg-slate-50 rounded-2xl h-24 outline-none font-mono text-xs" value={newEntry.example} onChange={e => setNewEntry({...newEntry, example: e.target.value})} />
                                <button type="submit" className="w-full bg-indigo-600 text-white py-5 rounded-[2rem] font-black text-lg">å­˜å…¥è¯åº“</button>
                            </form>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
