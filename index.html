<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>EduGlossary</title>
    <!-- 加载库文件 -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 图标库 -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* 防止移动端点击高亮 */
        * { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        // 这里的图标逻辑是针对 Lucide 在 React 里的特殊处理
        const Icon = ({ name, size = 24, className = "" }) => {
            const [svg, setSvg] = useState("");
            useEffect(() => {
                if (window.lucide) {
                    const iconSvg = lucide.createIcons();
                }
            }, []);
            return <i data-lucide={name} style={{width: size, height: size}} className={className}></i>;
        };

        const App = () => {
            const [activeTab, setActiveTab] = useState('python');
            const [searchTerm, setSearchTerm] = useState('');
            const [isAdding, setIsAdding] = useState(false);
            const [newEntry, setNewEntry] = useState({ term: '', definition: '', chinese: '', example: '' });

            const [glossary, setGlossary] = useState(() => {
                const saved = localStorage.getItem('edu_glossary_mobile_v1');
                return saved ? JSON.parse(saved) : {
                    python: [{ id: 1, term: 'Dictionary', definition: 'A collection of key-value pairs.', chinese: '字典', example: "my_dict = {'key': 'value'}" }],
                    statistics: [{ id: 1, term: 'Mean', definition: 'The average of a set of numbers.', chinese: '平均数', example: 'μ = (Σx) / n' }],
                    grammar: [{ id: 1, term: 'Relative Clause', definition: 'A clause that modifies a noun or noun phrase.', chinese: '定语从句', example: 'The book that I read was great.' }]
                };
            });

            useEffect(() => {
                localStorage.setItem('edu_glossary_mobile_v1', JSON.stringify(glossary));
                if (window.lucide) window.lucide.createIcons();
            }, [glossary, isAdding, activeTab]);

            const handleAdd = (e) => {
                e.preventDefault();
                if (!newEntry.term) return;
                const entry = { ...newEntry, id: Date.now() };
                setGlossary(prev => ({ ...prev, [activeTab]: [entry, ...prev[activeTab]] }));
                setNewEntry({ term: '', definition: '', chinese: '', example: '' });
                setIsAdding(false);
            };

            const deleteEntry = (id) => {
                if(window.confirm('确定要删除这条记录吗？')) {
                    setGlossary(prev => ({ ...prev, [activeTab]: prev[activeTab].filter(item => item.id !== id) }));
                }
            };

            const filteredData = glossary[activeTab].filter(item => 
                item.term.toLowerCase().includes(searchTerm.toLowerCase()) || 
                item.chinese.includes(searchTerm)
            );

            return (
                <div className="min-h-screen flex flex-col font-sans text-gray-900">
                    <header className="sticky top-0 z-20 bg-indigo-600 text-white shadow-md p-4 pb-6 rounded-b-3xl">
                        <div className="max-w-md mx-auto flex justify-between items-center mb-4">
                            <div className="flex items-center gap-2">
                                <h1 className="text-xl font-bold">EduGlossary</h1>
                            </div>
                            <button onClick={() => setIsAdding(true)} className="bg-white text-indigo-600 p-2 rounded-full shadow-lg">
                                <i data-lucide="plus"></i>
                            </button>
                        </div>
                        <div className="max-w-md mx-auto relative">
                            <i data-lucide="search" className="absolute left-4 top-1/2 -translate-y-1/2 text-indigo-300 w-5 h-5"></i>
                            <input 
                                type="text" 
                                placeholder="搜索术语或中文..." 
                                className="w-full bg-indigo-700/50 border-none rounded-2xl py-3 pl-12 pr-4 text-white placeholder:text-indigo-200 outline-none"
                                value={searchTerm}
                                onChange={(e) => setSearchTerm(e.target.value)}
                            />
                        </div>
                    </header>

                    <nav className="flex justify-center gap-4 p-4 sticky top-[130px] bg-gray-50/80 backdrop-blur-md z-10">
                        {['python', 'statistics', 'grammar'].map(tab => (
                            <button
                                key={tab}
                                onClick={() => setActiveTab(tab)}
                                className={`px-4 py-2 rounded-2xl text-xs font-bold uppercase ${activeTab === tab ? "bg-indigo-600 text-white shadow-md" : "text-gray-400 bg-white"}`}
                            >
                                {tab === 'grammar' ? 'English' : tab}
                            </button>
                        ))}
                    </nav>

                    <main className="flex-grow max-w-md mx-auto w-full px-4 pb-24">
                        <div className="space-y-4">
                            {filteredData.map(item => (
                                <div key={item.id} className="bg-white p-5 rounded-3xl shadow-sm border border-gray-100 relative">
                                    <div className="flex justify-between items-start mb-2">
                                        <span className="bg-indigo-50 text-indigo-600 text-[10px] font-black px-2 py-1 rounded-lg uppercase">{activeTab}</span>
                                        <button onClick={() => deleteEntry(item.id)} className="text-gray-300"><i data-lucide="trash-2" className="w-4 h-4"></i></button>
                                    </div>
                                    <h3 className="text-lg font-bold">{item.term}</h3>
                                    <p className="text-indigo-500 font-medium text-sm mb-3">{item.chinese}</p>
                                    <div className="text-sm text-gray-600 leading-snug">
                                        <span className="text-gray-400 font-bold text-[10px] block mb-0.5 uppercase">Definition</span>
                                        {item.definition}
                                    </div>
                                    {item.example && (
                                        <div className="mt-3 bg-gray-50 rounded-2xl p-3 border-l-2 border-indigo-200">
                                            <code className="text-xs text-indigo-700 block whitespace-pre-wrap break-all">{item.example}</code>
                                        </div>
                                    )}
                                </div>
                            ))}
                        </div>
                    </main>

                    {isAdding && (
                        <div className="fixed inset-0 z-50 bg-white flex flex-col p-6 animate-in slide-in-from-bottom">
                            <div className="flex justify-between items-center mb-6">
                                <h2 className="text-xl font-bold">新增 {activeTab} 记录</h2>
                                <button onClick={() => setIsAdding(false)} className="p-2 bg-gray-100 rounded-full"><i data-lucide="x"></i></button>
                            </div>
                            <form onSubmit={handleAdd} className="space-y-4 overflow-y-auto pb-10">
                                <input placeholder="学术术语 (Term)" className="w-full p-4 bg-gray-50 rounded-2xl outline-none border focus:border-indigo-500" value={newEntry.term} onChange={e => setNewEntry({...newEntry, term: e.target.value})} />
                                <input placeholder="中文解释" className="w-full p-4 bg-gray-50 rounded-2xl outline-none border focus:border-indigo-500" value={newEntry.chinese} onChange={e => setNewEntry({...newEntry, chinese: e.target.value})} />
                                <textarea placeholder="英文定义" className="w-full p-4 bg-gray-50 rounded-2xl outline-none border focus:border-indigo-500 h-32" value={newEntry.definition} onChange={e => setNewEntry({...newEntry, definition: e.target.value})} />
                                <textarea placeholder="例句或代码" className="w-full p-4 bg-gray-50 rounded-2xl outline-none border focus:border-indigo-500 h-24" value={newEntry.example} onChange={e => setNewEntry({...newEntry, example: e.target.value})} />
                                <button type="submit" className="w-full bg-indigo-600 text-white py-5 rounded-3xl font-bold text-lg">保存到我的词库</button>
                            </form>
                        </div>
                    )}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
